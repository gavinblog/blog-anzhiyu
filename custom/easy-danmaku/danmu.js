function danmu(){console.info(1111);const e=new EasyDanmaku({page:"/guestbook/",el:"#danmu",line:10,speed:20,hover:!0,loop:!0});let a=saveToLocal.get("danmu");if(a)e.batchSend(a,!0);else{let n=[];function t(e){return e=(e=(e=(e=(e=e.replace(/<\/*br>|[\s\uFEFF\xA0]+/g,"")).replace(/<img.*?>/g,"[图片]")).replace(/<a.*?>.*?<\/a>/g,"[链接]")).replace(/<pre.*?>.*?<\/pre>/g,"[代码块]")).replace(/<.*?>/g,"")}fetch("https://twikoo.geekswg.top/",{method:"POST",body:JSON.stringify({event:"GET_RECENT_COMMENTS",includeReply:!0,pageSize:100}),headers:{"Content-Type":"application/json"}}).then((e=>e.json())).then((({data:a})=>{a.forEach((e=>{null==e.avatar&&(e.avatar="https://cravatar.cn/avatar/d615d5793929e8c7d70eab5f00f7f5f1?d=mp"),n.push({avatar:e.avatar,content:e.nick+"："+t(e.comment),url:e.url+"#"+e.id})})),e.batchSend(n,!0),saveToLocal.set("danmu",n,.02)}))}}danmu(),document.addEventListener("pjax:complete",danmu);